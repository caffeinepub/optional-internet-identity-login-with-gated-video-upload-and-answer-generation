{
  "kind": "build_request",
  "title": "Fix answer generation echoing question and make custom riddle optional",
  "projectName": "Riddle Solver",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Fix the answer-generation flow so the returned/generated answer text is not simply the same text the user entered as the riddle/question.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "the generated answer is just the question"
        ]
      },
      "acceptanceCriteria": [
        "When a user generates an answer, the displayed “Generated Answer” text must not equal the provided riddle text (after trimming) in the common path.",
        "The frontend must send the user’s riddle text as riddle input (not as the answer output), and the backend must return an actual generated answer string.",
        "The backend must continue to persist the generated answer in canister state (answers map) while returning the generated answer text to the caller."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Make providing a custom riddle optional: allow generating an answer even if the user does not enter any riddle text.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "make adding your own riddle optional"
        ]
      },
      "acceptanceCriteria": [
        "The UI must provide a clear way to opt into providing a custom riddle (e.g., a toggle/checkbox labeled in English), and the default path must allow leaving the riddle empty.",
        "The “Generate Answer” action must not be blocked solely because the riddle text is empty when the user has chosen not to provide a custom riddle.",
        "User-facing validation/error messages must be updated so they do not instruct the user to enter riddle text when the custom riddle option is disabled."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Update the backend generateAnswer API behavior to treat the provided text parameter as optional riddle input and generate a non-empty answer even when that text is empty.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "the generated answer is just the question, and make adding your own riddle optional"
        ]
      },
      "acceptanceCriteria": [
        "Calling generateAnswer with an empty/whitespace riddle input must still succeed (assuming authorization passes) and return a non-empty generated answer text.",
        "Calling generateAnswer with a non-empty riddle input must return an answer that is not a direct echo of the riddle input.",
        "No state migration is required unless a breaking change to stable state is introduced (avoid changing stored Answer shape if possible)."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in backend/main.mo.",
    "Do not edit files in frontend immutablePaths (e.g., frontend/src/hooks/useInternetIdentity.ts(x), frontend/src/hooks/useActor.ts, frontend/src/main.tsx, and frontend/src/components/ui).",
    "Use English for all user-facing text."
  ],
  "nonGoals": [
    "Implementing real AI/LLM-based riddle solving or external AI integrations.",
    "Adding third-party authentication beyond Internet Identity.",
    "Adding new databases or external storage services."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}